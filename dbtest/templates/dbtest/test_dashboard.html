{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2>Model Test Dashboard</h2>
            <p class="text-muted">
                Testing {{ total_models }} models ({{ classification_count }} classification, {{ regression_count }} regression)
            </p>
        </div>
    </div>

    <!-- Test Controls -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Run Tests</h5>
                    <form method="post" action="{% url 'run_tests' %}" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="test_type" value="all">
                        <button type="submit" class="btn btn-primary">Run All Tests</button>
                    </form>
                    
                    <form method="post" action="{% url 'run_tests' %}" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="test_type" value="classification">
                        <button type="submit" class="btn btn-info">Test Classification</button>
                    </form>
                    
                    <form method="post" action="{% url 'run_tests' %}" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="test_type" value="regression">
                        <button type="submit" class="btn btn-success">Test Regression</button>
                    </form>
                    
                    <form method="post" action="{% url 'cleanup_tests' %}" class="d-inline float-end">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-danger" 
                                onclick="return confirm('Are you sure? This will delete all test runs.')">
                            Clean Up
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Latest Results -->
    {% if latest_run %}
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Latest Test Run</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Summary</h6>
                            <p>
                                Status: <span class="badge bg-{{ latest_run.status|yesno:'success,warning,danger' }}">
                                    {{ latest_run.status|title }}
                                </span><br>
                                Type: {{ latest_run.test_type|title }}<br>
                                Time: {{ latest_run.timestamp|date:"Y-m-d H:i:s" }}<br>
                                Duration: {{ latest_run.duration|floatformat:2 }}s
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Results</h6>
                            <p>
                                Passed: {{ latest_run.passed }}<br>
                                Failed: {{ latest_run.failed }}<br>
                                Errors: {{ latest_run.errors }}<br>
                                Pass Rate: {{ latest_run.pass_rate_display }}
                            </p>
                        </div>
                    </div>
                    <a href="{% url 'test_results' latest_run.id %}" class="btn btn-sm btn-outline-primary">
                        View Details
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Test History -->
    <div class="row">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Test History</h5>
                </div>
                <div class="card-body">
                    {% if test_runs %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Pass Rate</th>
                                    <th>Duration</th>
                                    <th>Timestamp</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for run in test_runs %}
                                <tr>
                                    <td>{{ run.id }}</td>
                                    <td>{{ run.test_type|title }}</td>
                                    <td>
                                        <span class="badge bg-{{ run.status|yesno:'success,warning,danger' }}">
                                            {{ run.status|title }}
                                        </span>
                                    </td>
                                    <td>{{ run.pass_rate_display }}</td>
                                    <td>{{ run.duration|floatformat:2 }}s</td>
                                    <td>{{ run.timestamp|date:"Y-m-d H:i:s" }}</td>
                                    <td>
                                        <a href="{% url 'test_results' run.id %}" class="btn btn-sm btn-outline-primary">
                                            Details
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">No test runs yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}